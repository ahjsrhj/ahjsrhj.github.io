<!DOCTYPE html><html lang=zh-CN><head><meta name=generator content="Hexo 3.9.0"><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><title>自定义View setLayerType()方法会引起View重绘 · Hexer</title><meta name=description content="自定义View setLayerType()方法会引起View重绘 - Hexer"><meta name=viewport content="width=device-width, initial-scale=1"><link rel=icon href=https://i.loli.net/2018/12/05/5c07807cb76f9.png><link rel=stylesheet href=/css/apollo.css><link rel=search type=application/opensearchdescription+xml href=https://imrhj.cn/atom.xml title=Hexer></head><body><div class=wrap><header><a href="/" class=logo-link><img src=https://i.loli.net/2018/12/05/5c07807cb76f9.png alt=logo></a><ul class="nav nav-list"><li class=nav-list-item><a href="/" target=_self class=nav-list-link>BLOG</a></li><li class=nav-list-item><a href="/archives/" target=_self class=nav-list-link>ARCHIVE</a></li><li class=nav-list-item><a href="/about/" target=_self class=nav-list-link>ABOUT</a></li><li class=nav-list-item><a href=https://github.com/ahjsrhj target=_blank class=nav-list-link>GITHUB</a></li><li class=nav-list-item><a href="/friend/" target=_self class=nav-list-link>FRIEND</a></li></ul><script src=/js/canvas-nest-check.js></script></header><main class=container><div class=post><article class=post-block><h1 class=post-title>自定义View setLayerType()方法会引起View重绘</h1><div class=post-info>2016年5月24日</div><div class=post-content><p>在开发一个检测体温的APP时，采用了自定义View控件作为温度显示模块，之后由于需要给背景添加阴影层，调用了<code>Paint.setShadowLayer()</code>方法，然而添加这个方法之后<code>View</code>没有任何反应，<code>Google</code>说需要给View设置软渲染，具体做法为调用<code>View</code>的<code>setLayerType(LAYER_TYPE_SOFTWARE, null)</code>方法，在开启它时，之后进行的绘制都会绘制到一张<code>Bitmap(software layer)</code>上，绘制完成后再渲染到<code>hardware layer</code>上。</p><blockquote><p>官网介绍<a href=https://developer.android.com/reference/android/view/View.html#LAYER_TYPE_SOFTWARE target=_blank rel=noopener>如下</a></p></blockquote><p>然而在使用过程中，我发现View开始不停的重绘，开始以为是<code>LAYER_TYPE_SOFTWARE</code>的特性，因为将其换成<code>LAYER_TYPE_HARDWARE</code>就不会发生重绘，<del>当然这样做以后上图中的阴影也没有了。。</del>然后发现<code>setLayerType</code>方法被我放在了onDraw方法里。。才发现这个方法会引起View重绘，View重绘又再次调用这个方法，于是</p><h1 id=Boom！！！！！！！！！！！！！><a href=#Boom！！！！！！！！！！！！！ class=headerlink title=Boom！！！！！！！！！！！！！></a>Boom！！！！！！！！！！！！！</h1></div></article></div></main><footer><div class=paginator><a href="/2016/use_sharedpreferences/" class=prev>PREV</a><a href="/2016/android-translucent-status/" class=next>NEXT</a></div><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        var vl = document.createElement('script');
        vl.src = '//cdn1.lncld.net/static/js/3.0.4/av-min.js';
        vl.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl);
        var vl2 = document.createElement('script');
        vl2.src = '//unpkg.com/valine/dist/Valine.min.js';
        vl2.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl2);
        var commitDiv = document.createElement('div');
        commitDiv.id='comment';
        document.getElementsByTagName('footer')[0].appendChild(commitDiv);
    })();
}</script><div class=copyright><p>© 2015 - 2021 <a href=https://imrhj.cn>Hexer</a>, <a href="http://beian.miit.gov.cn/" target=_blank>皖ICP备16006159号-1</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity=sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW crossorigin=anonymous></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-109294877-1",'auto');ga('send','pageview');</script><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        let _tt = 20;
        let _tc = setInterval(() => {
            try {
                new Valine({
                    el: '#comment' ,
                    notify:false, 
                    verify:false, 
                    appId: 'lMIQlAfa6UoprWfiEDOceMSz-gzGzoHsz',
                    appKey: 'KiGYzc5UupBdbac67AJA54dJ',
                    placeholder: '来都来了，说点啥不 ٩(●˙▿˙●)۶…⋆ฺ',
                    path:window.location.pathname, 
                    avatar:'identicon',
                    guest_info: ['nick','link']
                });
                clearInterval(_tc)
            } catch(e) {
                _tt--;
                if (_tt < 1) {
                    clearInterval(_tc)
                }
            }
        }, 500)
    })();
}</script></body></html>