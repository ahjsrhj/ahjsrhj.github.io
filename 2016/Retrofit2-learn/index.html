<!DOCTYPE html><html lang=zh-CN><head><meta name=generator content="Hexo 3.9.0"><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><title>Retrofit2学习笔记 · Hexer</title><meta name=description content="Retrofit2学习笔记 - Hexer"><meta name=viewport content="width=device-width, initial-scale=1"><link rel=icon href=https://i.loli.net/2018/12/05/5c07807cb76f9.png><link rel=stylesheet href=/css/apollo.css><link rel=search type=application/opensearchdescription+xml href=https://imrhj.cn/atom.xml title=Hexer></head><body><div class=wrap><header><a href="/" class=logo-link><img src=https://i.loli.net/2018/12/05/5c07807cb76f9.png alt=logo></a><ul class="nav nav-list"><li class=nav-list-item><a href="/" target=_self class=nav-list-link>BLOG</a></li><li class=nav-list-item><a href="/archives/" target=_self class=nav-list-link>ARCHIVE</a></li><li class=nav-list-item><a href="/about/" target=_self class=nav-list-link>ABOUT</a></li><li class=nav-list-item><a href=https://github.com/ahjsrhj target=_blank class=nav-list-link>GITHUB</a></li><li class=nav-list-item><a href="/friend/" target=_self class=nav-list-link>FRIEND</a></li></ul><script src=/js/canvas-nest-check.js></script></header><main class=container><div class=post><article class=post-block><h1 class=post-title>Retrofit2学习笔记</h1><div class=post-info>2016年4月16日</div><div class=post-content><p><img src=https://i.loli.net/2019/06/14/5d035d665a7e196570.png></p><p>平时在进行 Android 开发的时候，如果需要进行网络请求，一般都会选择使用<strong>HttpURLConnection</strong> 和 <strong>HttpClient</strong>。但是这两个用起来实在太过繁琐，需要设置一大堆，如果不封装的话，代码的复用率太低，所以就有了Android 的网络通信框架，比如 <a href=https://github.com/AsyncHttpClient/async-http-client target=_blank rel=noopener><strong>AsyncHttpClient</strong></a>,这是一个异步的网络请求框架，使用它不必考虑线程的问题，其网络请求都在非 UI 线程中执行。还有就是 <a href=http://developer.android.com/intl/zh-cn/training/volley/index.html target=_blank rel=noopener><strong>Volley</strong></a>，其优点在于处理小文件的 http 请求，在下载大文件的时候性能就比较糟糕了。最后是<a href=https://github.com/square/okhttp target=_blank rel=noopener><strong>okhttp</strong></a>，它是Android版Http客户端。非常高效，支持SPDY、连接池、GZIP和 HTTP 缓存。还有今天的主角，<a href="http://square.github.io/retrofit/" target=_blank rel=noopener><strong>Retrofit</strong></a>。</p><a id=more></a><h1 id=0x0-简介><a href=#0x0-简介 class=headerlink title="0x0 简介"></a>0x0 简介</h1><blockquote><p>A type-safe HTTP client for Android and Java</p></blockquote><p>它是一个Square开发的类型安全的REST安卓客户端请求库。这个库为网络认证、API请求以及用OkHttp发送网络请求提供了强大的框架。</p><h1 id=0x1-设置><a href=#0x1-设置 class=headerlink title="0x1 设置"></a>0x1 设置</h1><p>在 module 的 Gradle 里添加<code>compile &#39;com.squareup.retrofit2:retrofit:2.0.2&#39;</code>，之后点击<em>Sync Now</em>同步即可。 如果你想让接收的字符串自动解析成自己想要的结果，还需要添加Converter。有如下可选:</p><ul><li><a href=https://github.com/google/gson target=_blank rel=noopener>Gson</a>: com.squareup.retrofit2:converter-gson</li><li><a href=http://wiki.fasterxml.com/JacksonHome target=_blank rel=noopener>Jackson</a>: com.squareup.retrofit2:converter-jackson</li><li><a href="https://github.com/square/moshi/" target=_blank rel=noopener>Moshi</a>: com.squareup.retrofit2:converter-moshi</li><li><a href="https://developers.google.com/protocol-buffers/" target=_blank rel=noopener>Protobuf</a>: com.squareup.retrofit2:converter-protobuf</li><li><a href=https://github.com/square/wire target=_blank rel=noopener>Wire</a>: com.squareup.retrofit2:converter-wire</li><li><a href="http://simple.sourceforge.net/" target=_blank rel=noopener>Simple XML</a>: com.squareup.retrofit2:converter-simplexml</li><li>Scalars (primitives, boxed, and String): com.squareup.retrofit2:converter-scalars</li></ul><p>比如添加 Gson，需要在 Gradle 里添加<code>compile &#39;com.squareup.retrofit2:converter-gson:2.0.2&#39;</code></p><h1 id=0x2-使用><a href=#0x2-使用 class=headerlink title="0x2 使用"></a>0x2 使用</h1><p>我们以<a href=http://gank.io target=_blank rel=noopener>干货集中营</a>的 API 接口为例。比如获取10张<del>福利</del>照片的 api :<code>http://gank.io/api/data/福利/10/1</code></p><h2 id=1-配置><a href=#1-配置 class=headerlink title="1. 配置"></a>1. 配置</h2><p>在 module 的 Gradle 里添加依赖:<br><figure class="highlight gradle"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>compile</span> <span class=string>'com.squareup.retrofit2:retrofit:2.0.2'</span></span><br><span class=line><span class=keyword>compile</span> <span class=string>'com.squareup.retrofit2:converter-gson:2.0.2'</span></span><br></pre></td></tr></table></figure></p><p>还要确定你在 <strong>AndroidMainfest.xml</strong> 中请求了网络权限:<br><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>uses-permission</span> <span class=attr>android:name</span>=<span class=string>"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id=2-根据-json-生成-model><a href=#2-根据-json-生成-model class=headerlink title="2. 根据 json 生成 model"></a>2. 根据 json 生成 model</h2><p>在这里安利一款 Android Studio 插件：<a href=https://github.com/zzz40500/GsonFormat target=_blank rel=noopener>GsonFormat</a>，它能够根据JSONObject格式的字符串,自动生成实体类参数.</p><p>打开API 的地址，能够看到 json 如下:<br><figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre></td><td class=code><pre><span class=line>&#123;</span><br><span class=line>  <span class=attr>"error"</span>: <span class=literal>false</span>,</span><br><span class=line>  <span class=attr>"results"</span>: [</span><br><span class=line>    &#123;</span><br><span class=line>      <span class=attr>"_id"</span>: <span class=string>"57105d6e67765974fbfcf8f4"</span>,</span><br><span class=line>      <span class=attr>"createdAt"</span>: <span class=string>"2016-04-15T11:18:06.529Z"</span>,</span><br><span class=line>      <span class=attr>"desc"</span>: <span class=string>"4.15"</span>,</span><br><span class=line>      <span class=attr>"publishedAt"</span>: <span class=string>"2016-04-15T13:04:43.738Z"</span>,</span><br><span class=line>      <span class=attr>"source"</span>: <span class=string>"chrome"</span>,</span><br><span class=line>      <span class=attr>"type"</span>: <span class=string>"\u798f\u5229"</span>,</span><br><span class=line>      <span class=attr>"url"</span>: <span class=string>"http://ww3.sinaimg.cn/large/7a8aed7bjw1f2x7vxkj0uj20d10mi42r.jpg"</span>,</span><br><span class=line>      <span class=attr>"used"</span>: <span class=literal>true</span>,</span><br><span class=line>      <span class=attr>"who"</span>: <span class=string>"\u5f20\u6db5\u5b87"</span></span><br><span class=line>    &#125;</span><br><span class=line>  ]</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure></p><p>使用它生成的实体类如下:<br><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>public</span> <span class=class><span class=keyword>class</span> <span class=title>Model</span> </span>&#123;</span><br><span class=line>    <span class=keyword>private</span> List&lt;ResultsBean&gt; results;</span><br><span class=line>    <span class=function><span class=keyword>public</span> <span class=keyword>boolean</span> <span class=title>isError</span><span class=params>()</span> </span>&#123;</span><br><span class=line>        <span class=keyword>return</span> error;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setError</span><span class=params>(<span class=keyword>boolean</span> error)</span> </span>&#123;</span><br><span class=line>        <span class=keyword>this</span>.error = error;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=function><span class=keyword>public</span> List&lt;ResultsBean&gt; <span class=title>getResults</span><span class=params>()</span> </span>&#123;</span><br><span class=line>        <span class=keyword>return</span> results;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setResults</span><span class=params>(List&lt;ResultsBean&gt; results)</span> </span>&#123;</span><br><span class=line>        <span class=keyword>this</span>.results = results;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=class><span class=keyword>class</span> <span class=title>ResultsBean</span> </span>&#123;</span><br><span class=line>        <span class=keyword>private</span> String _id;</span><br><span class=line>        <span class=keyword>private</span> String createdAt;</span><br><span class=line>        <span class=keyword>private</span> String desc;</span><br><span class=line>        <span class=keyword>private</span> String publishedAt;</span><br><span class=line>        <span class=keyword>private</span> String source;</span><br><span class=line>        <span class=keyword>private</span> String type;</span><br><span class=line>        <span class=keyword>private</span> String url;</span><br><span class=line>        <span class=keyword>private</span> <span class=keyword>boolean</span> used;</span><br><span class=line>        <span class=keyword>private</span> String who;</span><br><span class=line></span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>get_id</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> _id;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>set_id</span><span class=params>(String _id)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>._id = _id;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>getCreatedAt</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> createdAt;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setCreatedAt</span><span class=params>(String createdAt)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.createdAt = createdAt;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>getDesc</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> desc;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setDesc</span><span class=params>(String desc)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.desc = desc;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>getPublishedAt</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> publishedAt;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setPublishedAt</span><span class=params>(String publishedAt)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.publishedAt = publishedAt;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>getSource</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> source;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setSource</span><span class=params>(String source)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.source = source;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>getType</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> type;</span><br><span class=line>        &#125;</span><br><span class=line></span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setType</span><span class=params>(String type)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.type = type;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>getUrl</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> url;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setUrl</span><span class=params>(String url)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.url = url;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>boolean</span> <span class=title>isUsed</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> used;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setUsed</span><span class=params>(<span class=keyword>boolean</span> used)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.used = used;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> String <span class=title>getWho</span><span class=params>()</span> </span>&#123;</span><br><span class=line>            <span class=keyword>return</span> who;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>setWho</span><span class=params>(String who)</span> </span>&#123;</span><br><span class=line>            <span class=keyword>this</span>.who = who;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure></p><h2 id=3-新建一个接口><a href=#3-新建一个接口 class=headerlink title="3. 新建一个接口"></a>3. 新建一个接口</h2><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>public</span> <span class=class><span class=keyword>interface</span> <span class=title>GankIO</span> </span>&#123;</span><br><span class=line>    <span class=meta>@GET</span>(<span class=string>"/api/data/&#123;type&#125;/500/1"</span>)</span><br><span class=line>    <span class=function>Call&lt;Model&gt; <span class=title>get</span><span class=params>(@Path(<span class=string>"type"</span>)</span> String type)</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>在这里@GET 使用 JAVA 注解，在运行时使用 JAVA的反射机制进行处理。</p><p><code>{type}</code> 为要获取的类型，可以在代码中指定为别的类型，具体可以查看 干货集中营的 api 文档说明。</p><h2 id=4-新建-Retrofit对象并进行网络请求><a href=#4-新建-Retrofit对象并进行网络请求 class=headerlink title="4. 新建 Retrofit对象并进行网络请求"></a>4. 新建 Retrofit对象并进行网络请求</h2><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>final</span> String URL = <span class=string>"http://gank.io"</span>;</span><br><span class=line></span><br><span class=line>Retrofit retrofit = <span class=keyword>new</span> Retrofit.Builder()</span><br><span class=line>           .baseUrl(URL)</span><br><span class=line>           .addConverterFactory(GsonConverterFactory.create())</span><br><span class=line>           .build();</span><br></pre></td></tr></table></figure><p>之后根据 <code>retrofit</code> 创建一个 <code>GankIO</code> 对象:<br><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>GankIO gankIO = retrofit.create(GankIO<span class=class>.<span class=keyword>class</span>)</span>;</span><br><span class=line>Call&lt;Model&gt; call = gankIO.get(<span class=string>"福利"</span>);</span><br></pre></td></tr></table></figure></p><p>然后可以进行网络请求了:<br><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line>call.enqueue(<span class=keyword>new</span> Callback&lt;Model&gt;() &#123;</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>onResponse</span><span class=params>(Call&lt;Model&gt; call, Response&lt;Model&gt; response)</span> </span>&#123;</span><br><span class=line>        Model model = response.body();</span><br><span class=line>        <span class=keyword>if</span> (!model.isError()) &#123;</span><br><span class=line>            <span class=keyword>for</span> (Model.ResultsBean url : model.getResults()) &#123;</span><br><span class=line>                Log.d(TAG, <span class=string>"onResponse: "</span> + url);</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=meta>@Override</span></span><br><span class=line>    <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>onFailure</span><span class=params>(Call&lt;Model&gt; call, Throwable t)</span> </span>&#123;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;);</span><br></pre></td></tr></table></figure></p><p>就是这么简单轻松有木有！！！</p><h1 id=0x3-注解说明><a href=#0x3-注解说明 class=headerlink title="0x3 注解说明"></a>0x3 注解说明</h1><h2 id=1-GET><a href=#1-GET class=headerlink title="1. @GET"></a>1. @GET</h2><p>向目的URL发送GET请求，其中可以包含String类型参数，该参数附加到主URL后面。</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line><span class=meta>@GET</span>(<span class=string>"/api/data/Android/500/1"</span>)</span><br></pre></td></tr></table></figure><p>当参数中有<code>{}</code>花括号包含的字符串，表示需要使用<code>@Path</code>进行替换。</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=meta>@GET</span>(<span class=string>"/api/data/&#123;type&#125;/500/1"</span>)</span><br><span class=line><span class=function>Call&lt;Model&gt; <span class=title>get</span><span class=params>(@Path String type)</span></span>;</span><br><span class=line><span class=comment>//之后在代码中使用如下调用</span></span><br><span class=line> Call&lt;Model&gt; call = api.get(<span class=string>"Android"</span>);</span><br><span class=line> <span class=comment>//即 /api/data/Android/500/1</span></span><br></pre></td></tr></table></figure><p>当目标URL形如<code>http://www.exapmle.com/list?page=1</code>时，这里就不能使用<code>@Path</code>了，需要使用查询参数<code>@Query</code></p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line> <span class=meta>@GET</span>(<span class=string>"/list"</span>)</span><br><span class=line> <span class=function>Call&lt;ResponseBody&gt; <span class=title>list</span><span class=params>(@Query(<span class=string>"page"</span>)</span> <span class=keyword>int</span> page)</span>;</span><br><span class=line> <span class=comment>//之后在代码中使用如下调用</span></span><br><span class=line> Call&lt;ResponseBody&gt; call = api.list(<span class=number>1</span>);</span><br><span class=line> <span class=comment>//即 /list?page=1</span></span><br><span class=line></span><br><span class=line> <span class=comment>//当查询为多个时</span></span><br><span class=line> <span class=meta>@GET</span>(<span class=string>"/list"</span>)</span><br><span class=line> <span class=function>Call&lt;ResponseBody&gt; <span class=title>list</span><span class=params>(@Query(<span class=string>"category"</span>)</span> String.. categories)</span>;</span><br><span class=line> <span class=comment>//之后在代码中使用如下调用</span></span><br><span class=line> Call&lt;ResponseBody&gt; call = api.list(<span class=string>"bar"</span>, <span class=string>"baz"</span>);</span><br><span class=line> <span class=comment>//即 /list?category=bar&amp;category=baz</span></span><br><span class=line> </span><br><span class=line><span class=comment>//当为多组时</span></span><br><span class=line><span class=meta>@GET</span>(<span class=string>"/list"</span>)</span><br><span class=line><span class=function>Call&lt;ResponseBody&gt; <span class=title>list</span><span class=params>(@Query(<span class=string>"username"</span>)</span> String username, @<span class=title>Query</span><span class=params>(<span class=string>"password"</span>)</span> String password)</span>;</span><br><span class=line><span class=comment>//之后在代码中</span></span><br><span class=line>Call&lt;ResponseBody&gt; call = api.list(<span class=string>"admin"</span>, <span class=string>"123456"</span>);</span><br><span class=line><span class=comment>//即 /list?username=admin&amp;password=123456</span></span><br></pre></td></tr></table></figure><p>当需要查询多个参数时，也可以使用<code>@QueryMap</code></p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line>GET(<span class=string>"/search"</span>)</span><br><span class=line><span class=function>Call&lt;ResponseBody&gt; <span class=title>list</span><span class=params>(@QueryMap Map&lt;String, String&gt; filters)</span></span>;</span><br><span class=line><span class=comment>//---</span></span><br><span class=line>Call&lt;ResponseBody&gt; call = api.list(ImmutableMap.of(<span class=string>"foo"</span>, <span class=string>"bar"</span>, <span class=string>"kit"</span>, <span class=string>"kat"</span>));</span><br><span class=line><span class=comment>//即 /serach?foo=bar&amp;kit=kat</span></span><br></pre></td></tr></table></figure><h1 id=0x04-Tips><a href=#0x04-Tips class=headerlink title="0x04 Tips"></a>0x04 Tips</h1><h2 id=1-开启okhttp的log功能><a href=#1-开启okhttp的log功能 class=headerlink title="1. 开启okhttp的log功能"></a>1. 开启okhttp的log功能</h2><p>首先在APP的<code>build.gradle</code>中配置依赖:</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>compile <span class=string>'com.squareup.okhttp3:logging-interceptor:3.2.0'</span></span><br></pre></td></tr></table></figure><p>代码中做如下改动即可:</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>HttpLoggingInterceptor interceptor = <span class=keyword>new</span> HttpLoggingInterceptor();</span><br><span class=line>interceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class=line>OkHttpClient client = <span class=keyword>new</span> OkHttpClient.Builder().addInterceptor(interceptor).build();</span><br><span class=line></span><br><span class=line>Retrofit retrofit = <span class=keyword>new</span> Retrofit.Builder()</span><br><span class=line>                .baseUrl(URL)</span><br><span class=line>                .client(client)</span><br><span class=line>                .addConverterFactory(GsonConverterFactory.create())</span><br><span class=line>                .build();</span><br></pre></td></tr></table></figure><p>Logcat如下：</p><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line>04-30 19:18:05.284 6638-6707/cn.imrhj.mydemo D/OkHttp: --&gt; GET http://www.games-cube.com/combat/api/login?username=xxxx&amp;password=xxxxx http/1.1</span><br><span class=line>04-30 19:18:05.284 6638-6707/cn.imrhj.mydemo D/OkHttp: --&gt; END GET</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: &lt;-- 200 OK http://www.games-cube.com/combat/api/login?username=xxxx&amp;password=xxxx (58ms)</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: Cache-Control: private</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: Transfer-Encoding: chunked</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: Content-Type: application/json; charset=utf-8</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: Server: Microsoft-IIS/8.0</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: Set-Cookie: ASP.NET_SessionId=e301ckyfpbzfbajkcepvnnu3; path=/; HttpOnly</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: X-AspNetMvc-Version: 5.2</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: X-AspNet-Version: 4.0.30319</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: X-Powered-By: ASP.NET</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: Date: Sat, 30 Apr 2016 11:18:05 GMT</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: OkHttp-Sent-Millis: 1462015085317</span><br><span class=line>04-30 19:18:05.342 6638-6707/cn.imrhj.mydemo D/OkHttp: OkHttp-Received-Millis: 1462015085339</span><br><span class=line>04-30 19:18:05.343 6638-6707/cn.imrhj.mydemo D/OkHttp: &#123;&quot;key&quot;:&quot;f8716ab6-712a-4622-be5b-fd950326acb2&quot;,&quot;code&quot;:&quot;1&quot;&#125;</span><br><span class=line>04-30 19:18:05.343 6638-6707/cn.imrhj.mydemo D/OkHttp: &lt;-- END HTTP (57-byte body)</span><br><span class=line>04-30 19:18:05.350 6638-6638/cn.imrhj.mydemo D/MainAcitivty: onResponse: key:f8716ab6-712a-4622-be5b-fd950326acb2, code:1</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class=paginator><a href="/2016/the-interview-knowledge/" class=prev>PREV</a><a href="/2016/use-github-webhook/" class=next>NEXT</a></div><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        var vl = document.createElement('script');
        vl.src = '//cdn1.lncld.net/static/js/3.0.4/av-min.js';
        vl.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl);
        var vl2 = document.createElement('script');
        vl2.src = '//unpkg.com/valine/dist/Valine.min.js';
        vl2.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl2);
        var commitDiv = document.createElement('div');
        commitDiv.id='comment';
        document.getElementsByTagName('footer')[0].appendChild(commitDiv);
    })();
}</script><div class=copyright><p>© 2015 - 2021 <a href=https://imrhj.cn>Hexer</a>, <a href="http://beian.miit.gov.cn/" target=_blank>皖ICP备16006159号-1</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity=sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW crossorigin=anonymous></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-109294877-1",'auto');ga('send','pageview');</script><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        let _tt = 20;
        let _tc = setInterval(() => {
            try {
                new Valine({
                    el: '#comment' ,
                    notify:false, 
                    verify:false, 
                    appId: 'lMIQlAfa6UoprWfiEDOceMSz-gzGzoHsz',
                    appKey: 'KiGYzc5UupBdbac67AJA54dJ',
                    placeholder: '来都来了，说点啥不 ٩(●˙▿˙●)۶…⋆ฺ',
                    path:window.location.pathname, 
                    avatar:'identicon',
                    guest_info: ['nick','link']
                });
                clearInterval(_tc)
            } catch(e) {
                _tt--;
                if (_tt < 1) {
                    clearInterval(_tc)
                }
            }
        }, 500)
    })();
}</script></body></html>