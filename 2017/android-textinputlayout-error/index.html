<!DOCTYPE html><html lang=zh-CN><head><meta name=generator content="Hexo 3.9.0"><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><title>Android TextInputLayout 使用时的坑 · Hexer</title><meta name=description content="Android TextInputLayout 使用时的坑 - Hexer"><meta name=viewport content="width=device-width, initial-scale=1"><link rel=icon href=https://i.loli.net/2018/12/05/5c07807cb76f9.png><link rel=stylesheet href=/css/apollo.css><link rel=search type=application/opensearchdescription+xml href=https://imrhj.cn/atom.xml title=Hexer></head><body><div class=wrap><header><a href="/" class=logo-link><img src=https://i.loli.net/2018/12/05/5c07807cb76f9.png alt=logo></a><ul class="nav nav-list"><li class=nav-list-item><a href="/" target=_self class=nav-list-link>BLOG</a></li><li class=nav-list-item><a href="/archives/" target=_self class=nav-list-link>ARCHIVE</a></li><li class=nav-list-item><a href="/about/" target=_self class=nav-list-link>ABOUT</a></li><li class=nav-list-item><a href=https://github.com/ahjsrhj target=_blank class=nav-list-link>GITHUB</a></li><li class=nav-list-item><a href="/friend/" target=_self class=nav-list-link>FRIEND</a></li></ul><script src=/js/canvas-nest-check.js></script></header><main class=container><div class=post><article class=post-block><h1 class=post-title>Android TextInputLayout 使用时的坑</h1><div class=post-info>2017年12月13日</div><div class=post-content><p><img src=https://i.loli.net/2019/06/14/5d035bf328e3d88029.png alt=1560501234327.png><br>在使用 <code>TextInputLayout</code> 编写一个登录界面时，发现一个深坑，记录下来。<br>简单的布局文件如下所示<br><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>android.support.design.widget.TextInputLayout</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:layout_width</span>=<span class=string>"match_parent"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:layout_height</span>=<span class=string>"wrap_content"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:layout_marginEnd</span>=<span class=string>"50dp"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:layout_marginStart</span>=<span class=string>"50dp"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:layout_marginTop</span>=<span class=string>"20dp"</span>&gt;</span></span><br><span class=line> <span class=tag>&lt;<span class=name>EditText</span>  <span class=attr>android:id</span>=<span class=string>"@+id/etMail"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:layout_width</span>=<span class=string>"match_parent"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:layout_height</span>=<span class=string>"wrap_content"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:hint</span>=<span class=string>"@string/mail"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:imeOptions</span>=<span class=string>"actionNext"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:inputType</span>=<span class=string>"textEmailAddress"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:lines</span>=<span class=string>"1"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:singleLine</span>=<span class=string>"true"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:textColor</span>=<span class=string>"@android:color/white"</span></span></span><br><span class=line><span class=tag>  <span class=attr>android:textSize</span>=<span class=string>"14sp"</span> /&gt;</span> </span><br><span class=line><span class=tag>&lt;/<span class=name>android.support.design.widget.TextInputLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>然而，此时 <code>TextInputLayout</code> 的未激活状态下hint的文字颜色为黑色，无法调整，查找<a href=https://stackoverflow.com/questions/30546430/how-to-change-the-floating-label-color-of-textinputlayout target=_blank rel=noopener>资料</a>得知，需要在style里添加一个theme，并复写<code>textColorHint</code>属性，如下<br><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>style</span> <span class=attr>name</span>=<span class=string>"TextLabel"</span> <span class=attr>parent</span>=<span class=string>"TextAppearance.AppCompat"</span>&gt;</span></span><br><span class=line><span class=xml>   <span class=comment>&lt;!-- Hint color and label color in FALSE state --&gt;</span></span></span><br><span class=line><span class=xml>   <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"android:textColorHint"</span>&gt;</span>@color/Color Name<span class=tag>&lt;/<span class=name>item</span>&gt;</span> </span></span><br><span class=line><span class=xml>   <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"android:textSize"</span>&gt;</span>20sp<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=xml>   <span class=comment>&lt;!-- Label color in TRUE state and bar color FALSE and TRUE State --&gt;</span></span></span><br><span class=line><span class=xml>   <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"colorAccent"</span>&gt;</span>@color/Color Name<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=xml>   <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"colorControlNormal"</span>&gt;</span>@color/Color Name<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=xml>   <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"colorControlActivated"</span>&gt;</span>@color/Color Name<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=tag>&lt;/<span class=name>style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>然后将该theme添加到<code>TextInputLayout</code>中，然而我这样做之后，颜色样式确实改变了，但是在尝试添加error提示的时候崩溃了，<br>报错<code>java.lang.UnsupportedOperationException: Failed to resolve attribute at index 4: TypedValue{t=0x2/d=0x1010099 a=1}</code>。<br>Google一番找到的解决方案对我无效。<br>猜测是Android Design库升级之后部分行为发生了变更。<br>尝试更换<code>TextLabel</code> Theme 的 parent 主题为Material包下的主题，失败。<br>搜索之后，发现正确应该继承<code>Widget.Design.TextInputLayout</code>。之后一切表现正常<br>完整Theme主题如下:<br><figure class="highlight xml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>style</span> <span class=attr>name</span>=<span class=string>"TextLabel"</span> <span class=attr>parent</span>=<span class=string>"Widget.Design.TextInputLayout"</span> &gt;</span></span><br><span class=line><span class=xml> <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"android:textColorHint"</span>&gt;</span>@color/colorWhite5<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=xml> <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"android:textSize"</span>&gt;</span>14sp<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=xml> <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"colorAccent"</span>&gt;</span>@color/colorRedAccept<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=xml> <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"android:colorControlNormal"</span>&gt;</span>@color/colorWhite3<span class=tag>&lt;/<span class=name>item</span>&gt;</span></span></span><br><span class=line><span class=xml> <span class=tag>&lt;<span class=name>item</span> <span class=attr>name</span>=<span class=string>"android:colorControlActivated"</span>&gt;</span>@color/colorRedText<span class=tag>&lt;/<span class=name>item</span>&gt;</span> </span></span><br><span class=line><span class=tag>&lt;/<span class=name>style</span>&gt;</span></span><br></pre></td></tr></table></figure></p></div></article></div></main><footer><div class=paginator><a href="/2018/build-properties-on-android-o/" class=prev>PREV</a><a href="/2017/esxi-for-samsung-noteboot/" class=next>NEXT</a></div><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        var vl = document.createElement('script');
        vl.src = '//cdn1.lncld.net/static/js/3.0.4/av-min.js';
        vl.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl);
        var vl2 = document.createElement('script');
        vl2.src = '//unpkg.com/valine/dist/Valine.min.js';
        vl2.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl2);
        var commitDiv = document.createElement('div');
        commitDiv.id='comment';
        document.getElementsByTagName('footer')[0].appendChild(commitDiv);
    })();
}</script><div class=copyright><p>© 2015 - 2021 <a href=https://imrhj.cn>Hexer</a>, <a href="http://beian.miit.gov.cn/" target=_blank>皖ICP备16006159号-1</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity=sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW crossorigin=anonymous></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-109294877-1",'auto');ga('send','pageview');</script><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        let _tt = 20;
        let _tc = setInterval(() => {
            try {
                new Valine({
                    el: '#comment' ,
                    notify:false, 
                    verify:false, 
                    appId: 'lMIQlAfa6UoprWfiEDOceMSz-gzGzoHsz',
                    appKey: 'KiGYzc5UupBdbac67AJA54dJ',
                    placeholder: '来都来了，说点啥不 ٩(●˙▿˙●)۶…⋆ฺ',
                    path:window.location.pathname, 
                    avatar:'identicon',
                    guest_info: ['nick','link']
                });
                clearInterval(_tc)
            } catch(e) {
                _tt--;
                if (_tt < 1) {
                    clearInterval(_tc)
                }
            }
        }, 500)
    })();
}</script></body></html>