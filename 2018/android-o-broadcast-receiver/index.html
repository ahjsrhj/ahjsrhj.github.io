<!DOCTYPE html><html lang=zh-CN><head><meta name=generator content="Hexo 3.9.0"><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><title>Android O 隐式广播的变更 · Hexer</title><meta name=description content="Android O 隐式广播的变更 - Hexer"><meta name=viewport content="width=device-width, initial-scale=1"><link rel=icon href=https://i.loli.net/2018/12/05/5c07807cb76f9.png><link rel=stylesheet href=/css/apollo.css><link rel=search type=application/opensearchdescription+xml href=https://imrhj.cn/atom.xml title=Hexer></head><body><div class=wrap><header><a href="/" class=logo-link><img src=https://i.loli.net/2018/12/05/5c07807cb76f9.png alt=logo></a><ul class="nav nav-list"><li class=nav-list-item><a href="/" target=_self class=nav-list-link>BLOG</a></li><li class=nav-list-item><a href="/archives/" target=_self class=nav-list-link>ARCHIVE</a></li><li class=nav-list-item><a href="/about/" target=_self class=nav-list-link>ABOUT</a></li><li class=nav-list-item><a href=https://github.com/ahjsrhj target=_blank class=nav-list-link>GITHUB</a></li><li class=nav-list-item><a href="/friend/" target=_self class=nav-list-link>FRIEND</a></li></ul><script src=/js/canvas-nest-check.js></script></header><main class=container><div class=post><article class=post-block><h1 class=post-title>Android O 隐式广播的变更</h1><div class=post-info>2018年5月15日</div><div class=post-content><p><img src=https://i.loli.net/2018/05/15/5afaacd581c22.png alt=android-o-hero.1913b82c89274bfa9e3072ee0f1add4d.png></p><p>今天来说一下 Android O 中对于隐式广播的变更，完整的变更在<a href=https://developer.android.com/about/versions/oreo/android-8.0-changes target=_blank rel=noopener><strong>这里</strong></a>可以看到。</p><a id=more></a><p>在 Android N 中，Google移除了三项隐式广播<code>(CONNECTIVITY_ACTION, ACTION_NEW_PICTURE, ACTION_NEW_VIDEO)</code>，而 Android O 中砍的更多，除了<a href=https://developer.android.com/guide/components/broadcast-exceptions target=_blank rel=noopener><strong>这里</strong></a>列出来的，其余的都被移除了。</p><p>除了移除一些广播之外，Android O 进行了更为严格的广播监听限制，<a href=https://developer.android.com/about/versions/oreo/background#broadcasts target=_blank rel=noopener><strong>这里</strong></a>可以看到具体的限制措施，总得来说静态注册的隐式广播接收器基本上都失效了，动态注册的不受影响，但是 App 被杀掉之后就无法生效了。官方推荐使用 <a href=https://developer.android.com/reference/android/app/job/JobScheduler.html target=_blank rel=noopener><strong>JobScheduler</strong></a> 来完成之前依赖隐私广播完成的操作。</p><p>并且除了这些由系统发出的隐式广播之外，由自己的应用自行发出的隐式广播也也无法被静态注册的广播接收器接收到。因此针对自己发出自己接收的隐式广播，成本最低的迁移方法是改为显式广播，只需要添加包名即可。</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>Intent intent = <span class=keyword>new</span> Intent(<span class=string>"cn.imrhj.test_action"</span>);</span><br><span class=line>intent.setPackage(getPackageName());</span><br><span class=line>sendBroadcast(intent);</span><br></pre></td></tr></table></figure><p>另一种方式是动态注册广播接收器，在一个运行中的 Activity 或者 Service 中进行动态注册即可。根据不同的场景自行选择。</p><p>如果你依赖某个隐式广播来唤醒 App 执行任务，那么你可能需要考虑使用 <strong>JobScheduler</strong> 了。</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line>Component service = <span class=keyword>new</span> ComponentName(<span class=keyword>this</span>,TestService<span class=class>.<span class=keyword>class</span>)</span>;</span><br><span class=line>JobInfo info = <span class=keyword>new</span> JobInfo.Builder(service)</span><br><span class=line>                  .setRequiresCharging(<span class=keyword>true</span>)  <span class=comment>// 是否充电</span></span><br><span class=line>                  .setRequiredNetworkType(JobInfo.NETWORK_TYPE_ANY) <span class=comment>// 网络类型</span></span><br><span class=line>                  .setPersisted(<span class=keyword>true</span>) <span class=comment>// 设备重启后是否继续</span></span><br><span class=line>                  .build();</span><br><span class=line>JobScheduler jobScheduler = (JobScheduler) getSystemService(Context.JOB_SCHEDULER_SERVICE);</span><br><span class=line>jobScheduler.schedule(info);</span><br></pre></td></tr></table></figure><p>JobScheduler 只支持 Android Lollipop 及以上的 Android 版本，因此如果你的项目 minSdkVersion 小于21,则需要考虑使用 <a href=https://github.com/evernote/android-job target=_blank rel=noopener>Android-Job</a> 这个第三方库，它能根据系统版本自动选择使用<code>JobScheduler</code>, <code>GcmNetworkManager</code> 或者 <code>AlarmManager</code>。</p></div></article></div></main><footer><div class=paginator><a href="/2018/only-fullscreen-opaque-activities-can-request-orientation/" class=prev>PREV</a><a href="/2018/build-properties-on-android-o/" class=next>NEXT</a></div><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        var vl = document.createElement('script');
        vl.src = '//cdn1.lncld.net/static/js/3.0.4/av-min.js';
        vl.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl);
        var vl2 = document.createElement('script');
        vl2.src = '//unpkg.com/valine/dist/Valine.min.js';
        vl2.async = true;
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(vl2);
        var commitDiv = document.createElement('div');
        commitDiv.id='comment';
        document.getElementsByTagName('footer')[0].appendChild(commitDiv);
    })();
}</script><div class=copyright><p>© 2015 - 2021 <a href=https://imrhj.cn>Hexer</a>, <a href="http://beian.miit.gov.cn/" target=_blank>皖ICP备16006159号-1</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity=sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW crossorigin=anonymous></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-109294877-1",'auto');ga('send','pageview');</script><script>var comments = 'true';
if (comments === 'true') {
    (function() {
        let _tt = 20;
        let _tc = setInterval(() => {
            try {
                new Valine({
                    el: '#comment' ,
                    notify:false, 
                    verify:false, 
                    appId: 'lMIQlAfa6UoprWfiEDOceMSz-gzGzoHsz',
                    appKey: 'KiGYzc5UupBdbac67AJA54dJ',
                    placeholder: '来都来了，说点啥不 ٩(●˙▿˙●)۶…⋆ฺ',
                    path:window.location.pathname, 
                    avatar:'identicon',
                    guest_info: ['nick','link']
                });
                clearInterval(_tc)
            } catch(e) {
                _tt--;
                if (_tt < 1) {
                    clearInterval(_tc)
                }
            }
        }, 500)
    })();
}</script></body></html>